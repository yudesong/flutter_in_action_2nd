# 工作流名称
name: Build and Deploy

# 触发条件
on:
    # 当 main 分支有代码推送时触发
    push:
        branches:
            - main

# 一个 workflow 可以包含多个 job
jobs:
    # job 唯一 key
    build-and-deploy:
        # 运行环境
        runs-on: ubuntu-latest

        # job 内的步骤
        steps:
            # 1. 拉取仓库代码
            - name: Checkout  ️
              uses: actions/checkout@v2.3.1

            # 2. 安装指定版本 Node.js
            - name: lock npm version
              uses: actions/setup-node@v3
              with:
                  node-version: 18.18.0

            # 3. 安装依赖并构建
            - name: Install and Build
              run: |
                  npm i -g pnpm
                  pnpm install
                  pnpm run docs:build
              env:
                  NODE_OPTIONS: '--max_old_space_size=4096'

            # 4. 部署到 GitHub Pages
            - name: Deploy
              uses: JamesIves/github-pages-deploy-action@4.1.3
              with:
                  BRANCH: gh-pages
                  FOLDER: docs/.vuepress/dist
                  ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
